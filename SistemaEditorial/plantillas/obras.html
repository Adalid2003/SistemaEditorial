{% extends 'base.html' %}

{% block title %}
Obras
{% endblock %}

{% block content %}
<div class="container mt-5">
    <h1 class="mb-4">Obras</h1>
    <button class="btn btn-primary mb-3" data-bs-toggle="modal" data-bs-target="#nuevaObraModal">Agregar Nueva Obra</button>
    <table class="table table-striped">
        <thead>
            <tr>
                <th>Título</th>
                <th>Autor</th>
                <th>Propietario</th>
                <th>Número de Páginas</th>
                <th>Tirada</th>
                <th>Portada</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% for obra in obras %}
            <tr>
                <td>{{ obra.tituloObra }}</td>
                <td>{{ obra.nombreAutorObra }}</td>
                <td>{{ obra.propietarioObra }}</td>
                <td>{{ obra.numeroPaginas }}</td>
                <td>{{ obra.tirada }}</td>
                <td>
                    <img src="{{ obra.portada.url }}" alt="Portada" width="50">
                </td>
                <td>
                    <!-- Botón editar -->
                    <a href="{% url 'editar_obra' obra.id_obra %}" class="btn btn-warning btn-sm">
                        <i class="bi bi-pencil"></i>
                    </a>
                    <!-- Botón eliminar -->
                    <form method="POST" action="{% url 'eliminar_obra' obra.id_obra %}" style="display:inline;">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('¿Seguro que deseas eliminar esta obra?');">
                            <i class="bi bi-trash"></i>
                        </button>
                    </form>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- Modal para agregar nueva obra -->
<div class="modal fade" id="nuevaObraModal" tabindex="-1" aria-labelledby="nuevaObraModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="nuevaObraModalLabel">Agregar Nueva Obra</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form method="POST" action="{% url 'agregar_obra' %}" enctype="multipart/form-data">
                {% csrf_token %}
                <div class="modal-body">
                    <!-- Campos del formulario -->
                    <div class="mb-3">
                        <label for="tituloObra" class="form-label">Título</label>
                        <input type="text" class="form-control" id="tituloObra" name="tituloObra" required>
                    </div>
                    <div class="mb-3">
                        <label for="nombreAutorObra" class="form-label">Autor</label>
                        <input type="text" class="form-control" id="nombreAutorObra" name="nombreAutorObra" required>
                    </div>
                    <div class="mb-3">
                        <label for="propietarioObra" class="form-label">Propietario</label>
                        <input type="text" class="form-control" id="propietarioObra" name="propietarioObra" required>
                    </div>
                    <div class="mb-3">
                        <label for="numeroPaginas" class="form-label">Número de Páginas</label>
                        <input type="number" class="form-control" id="numeroPaginas" name="numeroPaginas" required>
                    </div>
                    <div class="mb-3">
                        <label for="tirada" class="form-label">Tirada</label>
                        <input type="number" class="form-control" id="tirada" name="tirada" required>
                    </div>
                    <div class="mb-3">
                        <label for="portada" class="form-label">Portada</label>
                        <input type="file" class="form-control" id="portada" name="portada" accept="image/*" required>
                    </div>
                    <div class="mb-3">
                        <label for="id_material" class="form-label">Material</label>
                        <select class="form-control" id="id_material" name="id_material" required>
                            {% for material in materiales %}
                            <option value="{{ material.id_material }}">{{ material.nombreMaterial }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="id_maquinaria" class="form-label">Maquinaria</label>
                        <select class="form-control" id="id_maquinaria" name="id_maquinaria" required>
                            {% for maquinaria in maquinarias %}
                            <option value="{{ maquinaria.id_maquinaria }}">{{ maquinaria.nombreMaquinaria }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="submit" class="btn btn-primary">Guardar</button>
                </div>
            </form>
        </div>
    </div>
</div>
<script>
    function showSuccessAlert() {
        Swal.fire({
            icon: 'success',
            title: 'Obra agregada exitosamente',
            showConfirmButton: false,
            timer: 1500
        });
    }

    function confirmDelete(id) {
        Swal.fire({
            title: '¿Estás seguro?',
            text: "Esta acción no se puede deshacer.",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#3085d6',
            cancelButtonColor: '#d33',
            confirmButtonText: 'Sí, eliminar',
            cancelButtonText: 'Cancelar'
        }).then((result) => {
            if (result.isConfirmed) {
                window.location.href = `/obras/eliminar/${id}/`;
            }
        });
    }
</script>
{% endblock %}